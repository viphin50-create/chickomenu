<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ß–∏–∫–æ New - –ú–µ–Ω—é, –û–±—É—á–µ–Ω–∏–µ, –¢–µ—Å—Ç</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <style>
        /* Google Font: Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            /* –û—á–µ–Ω—å —Å–≤–µ—Ç–ª—ã–π —Å–µ—Ä—ã–π —Ñ–æ–Ω */
            background: #F8F8F8;
            min-height: 100vh;
            overflow-x: hidden;
            color: #333;
        }

        /* –°—Ç–∏–ª–∏ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeInUp 0.5s ease-out forwards;
        }

        /* –ö–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –ø–æ–∏—Å–∫–∞ —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º —Å—Ç–µ–∫–ª–∞ */
        .glass-btn {
            background: rgba(240, 240, 240, 0.7);
            backdrop-filter: blur(8px);
            /* –£–≤–µ–ª–∏—á–µ–Ω–Ω–æ–µ —Ä–∞–∑–º—ã—Ç–∏–µ –¥–ª—è –±–æ–ª–µ–µ –∑–∞–º–µ—Ç–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ */
            border: 1px solid rgba(200, 200, 200, 0.8);
            color: #333;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .glass-btn:hover {
            background: rgba(230, 230, 230, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
        }

        .glass-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) inset;
        }

        .glass-btn.active {
            background: #FF5E62;
            /* –ê–∫—Ç–∏–≤–Ω—ã–π —Ñ–æ–Ω - —è—Ä–∫–∏–π —Ü–≤–µ—Ç –±—Ä–µ–Ω–¥–∞ */
            color: white;
            font-weight: 800;
            border: 1px solid #FF5E62;
        }

        /* --- –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s forwards;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.85);
            /* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
            backdrop-filter: blur(10px);
            /* –≠—Ñ—Ñ–µ–∫—Ç —Å–∏–ª—å–Ω–æ–≥–æ —Å—Ç–µ–∫–ª–∞ */
            margin: 10% auto;
            padding: 2rem;
            border-radius: 1.5rem;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            animation: slideIn 0.3s forwards;
        }

        /* --- –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ --- */
        .nav-link {
            color: #6b7280;
            transition: color 0.3s, border-bottom 0.3s;
            padding-bottom: 4px;
            font-size: 1.125rem;
        }

        .nav-link:hover {
            color: #FF5E62;
        }

        .active-nav-link {
            color: #FF5E62;
            border-bottom: 4px solid #FF5E62;
            font-weight: 700;
        }

        .page-content {
            min-height: 50vh;
        }

        .hidden {
            display: none !important;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ —Ç–µ—Å—Ç–∞ */
        .training-button,
        .quiz-start-btn {
            background-color: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(8px);
            border: 1px solid #FF5E62;
            color: #FF5E62;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(255, 94, 98, 0.2);
        }

        .training-button:hover,
        .quiz-start-btn:hover {
            background-color: #FF5E62;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 94, 98, 0.4);
        }

        /* --- –°—Ç–∏–ª–∏ –¥–ª—è –ë–æ–∫–æ–≤–æ–≥–æ –ú–µ–Ω—é --- */
        .sidebar {
            /* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ "Push" –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ */
            max-width: 10rem; /* 160px */
            min-height: 70vh;
            /* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –¥–ª—è –≤—Å–µ—Ö —Å–≤–æ–π—Å—Ç–≤ (max-width, opacity, transform) */
            transition: all 0.3s ease-in-out; 
            /* –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
            width: 10rem;
        }
        
        /* –ö–ª–∞—Å—Å –¥–ª—è –∑–∞–∫—Ä—ã—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ (Push) */
        @media (min-width: 768px) {
            .sidebar-closed-desktop {
                max-width: 0 !important;
                padding: 0 !important;
                opacity: 0 !important;
                overflow: hidden !important;
                margin-right: 0 !important; /* –£–±–∏—Ä–∞–µ–º margin, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å */
            }
        }

        /* –ö–ª–∞—Å—Å –¥–ª—è —Å–∫—Ä—ã—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö (Overlay) */
        .sidebar-mobile-closed {
            transform: translateX(-100%);
        }
        
        .sidebar-link:hover {
            background-color: rgba(255, 94, 98, 0.05); /* Light red hover */
            color: #FF5E62;
        }
        
        /* --- –°—Ç–∏–ª–∏ –¥–ª—è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è --- */
        .quiz-option {
            @apply text-lg font-semibold py-4 px-6 rounded-xl border-2 cursor-pointer transition-all duration-200 shadow-md flex items-center justify-between;
            border-color: #e5e7eb;
            /* border-gray-200 */
            background-color: #ffffff;
            /* bg-white */
        }

        .quiz-option:hover:not(.disabled) {
            @apply border-[#FF5E62] shadow-lg;
        }

        .quiz-option.correct {
            @apply bg-green-100 border-green-500 text-green-700 shadow-xl;
        }

        .quiz-option.incorrect {
            @apply bg-red-100 border-red-500 text-red-700 shadow-xl;
        }

        .quiz-option.disabled {
            pointer-events: none;
        }

        .quiz-result-icon {
            font-size: 1.5rem;
            margin-left: 1rem;
        }
    </style>
</head>

<body class="p-4 sm:p-8 flex flex-col items-center justify-center">
    <div class="max-w-5xl mx-auto w-full">

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="flex justify-center mt-4 mb-4">
            <h1 class="text-5xl sm:text-6xl font-extrabold text-gray-800 drop-shadow-lg tracking-wide">
                –ß–ò–ö–û <span class="text-red-500 text-3xl align-top">New</span>
            </h1>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ -->
        <div id="navigation-links" class="flex justify-center gap-6 mb-8 mt-4 font-bold">
            <button class="nav-link active-nav-link" onclick="showPage('menu')">–ú–µ–Ω—é</button>
            <button class="nav-link" onclick="showPage('training')">–û–±—É—á–∞—é—â–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª</button>
            <button class="nav-link" onclick="showPage('testing')">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
        </div>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ (Sidebar + Content) -->
    <div class="flex flex-1 w-full max-w-7xl mx-auto mt-4 overflow-hidden">
        
        <!-- OVERLAY –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-10 hidden" onclick="closeSidebar()"></div>

        <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é –¥–ª—è –ö–∞—Ç–µ–≥–æ—Ä–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ú–µ–Ω—é) -->
        <aside id="sidebar" class="sidebar bg-white p-4 shadow-xl flex-shrink-0 z-20 rounded-xl overflow-y-auto 
                                   fixed inset-y-0 left-0 sidebar-mobile-closed 
                                   md:static md:block md:w-[10rem] md:p-4 md:opacity-100">
            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ JS -->
        </aside>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (–ú–µ–Ω—é, –û–±—É—á–µ–Ω–∏–µ, –¢–µ—Å—Ç) -->
        <div class="flex-1 min-h-screen px-4 md:px-6">

            <!-- –ö–û–ù–¢–ï–ù–¢ –°–¢–†–ê–ù–ò–¶–´ –ú–ï–ù–Æ -->
            <div id="menu-content" class="page-content flex flex-col items-center w-full">
                <!-- –ü–æ–∏—Å–∫ -->
                <div id="search-container" class="w-full mb-6 max-w-4xl mx-auto flex items-center gap-4">
                    <!-- –ö–Ω–æ–ø–∫–∞-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (–°–ï–ô–ß–ê–° –í–ò–î–ï–ù –í–ï–ó–î–ï) -->
                    <button id="sidebar-toggle" onclick="toggleSidebar()" class="p-3 rounded-xl glass-btn text-xl flex-shrink-0">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="relative rounded-full shadow-lg flex-grow">
                        <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞–ª–ª–µ—Ä–≥–µ–Ω–∞–º..."
                            class="glass-btn w-full px-6 py-3 rounded-full pl-12 transition-all duration-300 text-gray-800 placeholder-gray-500">
                        <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 text-xl"></i>
                    </div>
                </div>

                <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–°–ø–∏—Å–æ–∫) -->
                <div class="flex flex-col items-center w-full">

                    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
                    <div id="loading-spinner" class="text-center py-12">
                        <svg class="animate-spin h-12 w-12 text-[#FF5E62] mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.965l3-2.674zm13.715-6.195A7.962 7.962 0 0120 12h4c0-3.042-1.135-5.824-3-7.965l-3 2.674zM12 20a8 8 0 008-8h4c0 6.627-5.373 12-12 12v-4z"></path>
                        </svg>
                        <p class="mt-4 text-gray-600 font-medium text-lg">–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–Ω—é...</p>
                    </div>

                    <!-- –û–±–ª–∞—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ -->
                    <div id="card-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 w-full px-4">
                    </div>

                </div>
            </div>

            <!-- –ö–û–ù–¢–ï–ù–¢ –°–¢–†–ê–ù–ò–¶–´ –û–ë–£–ß–ê–Æ–©–ò–ô –ú–ê–¢–ï–†–ò–ê–õ -->
            <div id="training-content" class="page-content hidden">
                <div class="max-w-4xl mx-auto p-6 bg-white/70 backdrop-blur-md rounded-2xl shadow-xl border border-white/90">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2 border-red-200 text-center">
                        –ë–∞–∑–∞ –û–±—É—á–∞—é—â–∏—Ö –ú–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
                    </h2>

                    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫, –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö –∏–∑ Google Sheets -->
                    <div id="training-links-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <!-- –°—é–¥–∞ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ -->
                    </div>

                    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –æ–±—É—á–∞—é—â–µ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ -->
                    <div id="training-loading-spinner" class="text-center py-12 hidden">
                        <svg class="animate-spin h-12 w-12 text-[#FF5E62] mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.965l3-2.674zm13.715-6.195A7.962 7.962 0 0120 12h4c0-3.042-1.135-5.824-3-7.965l-3 2.674zM12 20a8 8 0 008-8h4c0 6.627-5.373 12-12 12v-4z"></path>
                        </svg>
                        <p class="mt-4 text-gray-600 font-medium text-lg">–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤...</p>
                    </div>

                </div>
            </div>

            <!-- –ö–û–ù–¢–ï–ù–¢ –°–¢–†–ê–ù–ò–¶–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï (–ù–û–í–´–ô) -->
            <div id="testing-content" class="page-content hidden">
                <div class="max-w-2xl mx-auto p-6 bg-white/70 backdrop-blur-md rounded-2xl shadow-xl border border-white/90">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2 border-red-200 text-center">
                        –¢–µ—Å—Ç –Ω–∞ –∑–Ω–∞–Ω–∏–µ –ê–ª–ª–µ—Ä–≥–µ–Ω–æ–≤ (10 –≤–æ–ø—Ä–æ—Å–æ–≤)
                    </h2>

                    <!-- 1. –ù–∞—á–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω / –ó–∞–≥—Ä—É–∑–∫–∞ -->
                    <div id="quiz-start-screen" class="text-center py-12">
                        <p id="quiz-load-status" class="text-gray-600 font-medium text-lg mb-6">
                            –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω—é –¥–ª—è –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã...
                        </p>
                        <button id="start-quiz-btn" onclick="startQuiz()"
                            class="quiz-start-btn px-8 py-3 rounded-full text-xl disabled:opacity-50" disabled>
                            <i class="fas fa-play mr-2"></i> –ù–∞—á–∞—Ç—å –¢–µ—Å—Ç
                        </button>
                    </div>

                    <!-- 2. –≠–∫—Ä–∞–Ω –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã -->
                    <div id="quiz-game-screen" class="hidden space-y-6">
                        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
                        <div class="flex justify-between items-center text-gray-600 font-medium">
                            <p>–í–æ–ø—Ä–æ—Å: <span id="current-question-index">0</span> / 10</p>
                            <p>–í–µ—Ä–Ω–æ: <span id="correct-count">0</span> / –ù–µ–≤–µ—Ä–Ω–æ: <span id="incorrect-count">0</span></p>
                        </div>
                        <!-- –í–æ–ø—Ä–æ—Å (–§–ª–µ—à-–∫–∞—Ä—Ç–æ—á–∫–∞) -->
                        <div
                            class="bg-white border-2 border-red-300 rounded-xl p-8 text-center shadow-inner h-40 flex items-center justify-center">
                            <h3 id="quiz-question-dish" class="text-3xl font-extrabold text-gray-800"></h3>
                        </div>
                        <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ -->
                        <div id="quiz-options-container" class="grid grid-cols-1 gap-3">
                            <!-- –ö–Ω–æ–ø–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        </div>
                    </div>

                    <!-- 3. –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
                    <div id="quiz-results-screen" class="hidden text-center py-12 space-y-6">
                        <h3 class="text-4xl font-extrabold text-gray-800">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¢–µ—Å—Ç–∞</h3>
                        <p class="text-lg text-gray-700">–í–∞—à —Å—á–µ—Ç:</p>
                        <p id="final-score" class="text-6xl font-black text-red-500"></p>
                        <div class="bg-red-50 p-4 rounded-xl border border-red-200">
                            <h4 class="text-xl font-bold text-red-700 mb-2">–¢–≤–æ–π –¢–∏—Ç—É–ª:</h4>
                            <p id="quiz-title" class="text-2xl font-extrabold text-gray-800"></p>
                        </div>
                        <button onclick="startQuiz(true)"
                            class="quiz-start-btn px-8 py-3 rounded-full text-xl w-full sm:w-auto mt-4">
                            <i class="fas fa-redo-alt mr-2"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å –°–Ω–æ–≤–∞
                        </button>
                    </div>

                    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º —Å –º–µ–Ω—é) -->
                    <div id="quiz-loading-spinner" class="text-center py-12 hidden">
                        <p class="mt-4 text-gray-600 font-medium text-lg">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω—é...</p>
                    </div>

                </div>
            </div>

        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <button class="close-btn absolute top-4 right-6 text-4xl text-gray-600 hover:text-red-500 transition-colors" onclick="closeModal()">&times;</button>
            <div id="modal-body" class="space-y-4 pt-6">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–æ —Å—é–¥–∞ —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É Google Sheets –¥–ª—è –ú–ï–ù–Æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ CSV
            const SHEET_URL_MENU = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT0ukbh5K5GdykFFCDj-H0xUODUAneKWmbeJFfe4tLTCMEWKJgCkefhrCOtsKDB_QRRYySAvI1xOTh3/pub?gid=993893041&single=true&output=csv';

            // –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É Google Sheets –¥–ª—è –û–ë–£–ß–ê–Æ–©–ï–ì–û –ú–ê–¢–ï–†–ò–ê–õ–ê –≤ —Ñ–æ—Ä–º–∞—Ç–µ CSV
            const SHEET_URL_TRAINING = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT0ukbh5K5GdykFFCDj-H0xUODUAneKWmbeJFfe4tLTCMEWKJgCkefhrCOtsKDB_QRRYySAvI1xOTh3/pub?gid=1664366590&single=true&output=csv';

            const cardContainer = document.getElementById('card-container');
            const menuSpinner = document.getElementById('loading-spinner');
            const trainingLinksContainer = document.getElementById('training-links-container');
            const trainingSpinner = document.getElementById('training-loading-spinner');
            
            const searchInput = document.getElementById('search-input');
            const productModal = document.getElementById('product-modal');
            const modalBody = document.getElementById('modal-body');

            const menuContent = document.getElementById('menu-content');
            const trainingContent = document.getElementById('training-content');
            const testingContent = document.getElementById('testing-content');

            // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –±–æ–∫–æ–≤–æ–≥–æ –º–µ–Ω—é
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const quizStartScreen = document.getElementById('quiz-start-screen');
            const quizGameScreen = document.getElementById('quiz-game-screen');
            const quizResultsScreen = document.getElementById('quiz-results-screen');
            const startQuizBtn = document.getElementById('start-quiz-btn');
            const quizLoadStatus = document.getElementById('quiz-load-status');

            // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–µ—Å—Ç–∞
            let allProducts = [];
            let allAllergens = new Set();
            let productsByCategory = {}; // –•—Ä–∞–Ω–∏–ª–∏—â–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            let displayedProducts = [];
            let allTrainingMaterials = [];

            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
            let quizCards = [];
            let currentCardIndex = 0;
            let correctAnswers = 0;
            let incorrectAnswers = 0;
            const TOTAL_QUESTIONS = 10;
            
            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ (–¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞)
            let isSidebarOpen = window.innerWidth >= 768; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫—Ä—ã—Ç–æ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ


            // --- UTILITIES (–û—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---

            /**
             * –í—ã–ø–æ–ª–Ω—è–µ—Ç fetch-–∑–∞–ø—Ä–æ—Å —Å –ª–æ–≥–∏–∫–æ–π —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏.
             */
            async function fetchWithRetry(url, maxRetries = 3, delay = 1000) {
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const res = await fetch(url);
                        if (!res.ok) {
                            throw new Error(`HTTP error! Status: ${res.status}`);
                        }
                        return res;
                    } catch (error) {
                        console.error(`Attempt ${i + 1} failed for ${url}:`, error);
                        if (i < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                        } else {
                            throw error;
                        }
                    }
                }
            }

            /**
             * –ü–∞—Ä—Å–∏—Ç CSV —Ç–µ–∫—Å—Ç –∏–∑ Google Sheets. (–û—Å—Ç–∞–ª–æ—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
             */
            function parseCSV(text, mode) {
                const results = [];
                const lines = text.split(/\r?\n/).filter(line => line.trim());

                if (lines.length === 0) return [];

                const splitCSVLine = (line) => {
                    const rowData = [];
                    let currentCell = '';
                    let inQuote = false;

                    for (let j = 0; j < line.length; j++) {
                        const char = line[j];

                        if (char === '"') {
                            if (j + 1 < line.length && line[j + 1] === '"') {
                                currentCell += '"';
                                j++;
                            } else {
                                inQuote = !inQuote;
                            }
                        } else if (char === ',' && !inQuote) {
                            rowData.push(currentCell);
                            currentCell = '';
                        } else {
                            currentCell += char;
                        }
                    }
                    rowData.push(currentCell);

                    return rowData.map(cell => {
                        let cleanCell = cell;
                        if (cleanCell.startsWith('"') && cleanCell.endsWith('"')) {
                            cleanCell = cleanCell.substring(1, cleanCell.length - 1);
                        }
                        return cleanCell.replace(/""/g, '"').trim();
                    });
                };

                const rawHeader = splitCSVLine(lines[0]);
                const header = rawHeader.map(h => h.toLowerCase().trim());

                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i];
                    const lineNumber = i + 1;
                    const rowData = splitCSVLine(line);

                    if (rowData.length === header.length) {
                        const item = {};
                        header.forEach((key, index) => {
                            item[key] = rowData[index] || '';
                        });

                        if (mode === 'menu') {
                            const pName = item['name'] || item['–Ω–∞–∑–≤–∞–Ω–∏–µ'] || item['–±–ª—é–¥–æ'] || '';
                            const pAllergen = item['allergen'] || item['–∞–ª–ª–µ—Ä–≥–µ–Ω—ã'] || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';

                            if (pName) {
                                item.display_name = pName;
                                item.display_image = item['image'] || item['—Å—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ'] || item['—Ñ–æ—Ç–æ'] || 'https://placehold.co/400x600/FFFFFF/FF5E62?text=–ù–µ—Ç+–§–æ—Ç–æ';
                                item.display_desc = item['–æ–ø–∏—Å–∞–Ω–∏–µ'] || item['–ø–æ–¥–∞—á–∞'] || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
                                item.display_allergen = pAllergen;
                                item.display_category = item['category'] || item['–∫–∞—Ç–µ–≥–æ—Ä–∏—è'] || '–û–±—â–µ–µ';
                                results.push(item);
                            } else {
                                console.warn(`Line ${lineNumber} skipped (Menu): Product name field is empty.`);
                            }
                        } else if (mode === 'training') {
                            const tName = item['–Ω–∞–∑–≤–∞–Ω–∏–µ'] || item['title'] || '';
                            const tLink = item['—Å—Å—ã–ª–∫–∞'] || item['link'] || '';

                            if (tName && tLink) {
                                item.display_name = tName;
                                item.display_link = tLink;
                                results.push(item);
                            } else {
                                console.warn(`Line ${lineNumber} skipped (Training): Missing Title or Link.`);
                            }
                        }
                    } else {
                        console.warn(`Line ${lineNumber} skipped: Column count mismatch.`);
                    }
                }
                return results;
            }

            /**
             * –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ (–ê–ª–≥–æ—Ä–∏—Ç–º –§–∏—à–µ—Ä–∞-–ô–µ—Ç—Å–∞). (–û—Å—Ç–∞–ª–∞—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
             */
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            // --- SIDEBAR FUNCTIONS (–û–ë–ù–û–í–õ–ï–ù–û) ---
            
            /**
             * –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –±–æ–∫–æ–≤–æ–≥–æ –º–µ–Ω—é: –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç/–∑–∞–∫—Ä—ã–≤–∞–µ—Ç.
             * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–∞–∑–Ω—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π (fixed/transform) –∏ –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–π (static/max-width) –≤–µ—Ä—Å–∏–π.
             */
            window.toggleSidebar = function() {
                if (window.innerWidth < 768) {
                    // –ú–û–ë–ò–õ–¨–ù–´–ô (Overlay)
                    if (sidebar.classList.contains('sidebar-mobile-closed')) {
                        sidebar.classList.remove('sidebar-mobile-closed');
                        sidebarOverlay.classList.remove('hidden');
                    } else {
                        sidebar.classList.add('sidebar-mobile-closed');
                        sidebarOverlay.classList.add('hidden');
                    }
                } else {
                    // –î–ï–°–ö–¢–û–ü (Pushing/Collapsing)
                    isSidebarOpen = !isSidebarOpen;
                    if (isSidebarOpen) {
                        sidebar.classList.remove('sidebar-closed-desktop');
                    } else {
                        sidebar.classList.add('sidebar-closed-desktop');
                    }
                }
            }

            // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∏–∫–æ–º –ø–æ –æ–≤–µ—Ä–ª–µ—é –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö)
            window.closeSidebar = function() {
                 if (window.innerWidth < 768) {
                     sidebar.classList.add('sidebar-mobile-closed');
                     sidebarOverlay.classList.add('hidden');
                 }
            }
            
            /**
             * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç –±–æ–∫–æ–≤–æ–µ –º–µ–Ω—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π. (–£–ë–†–ê–ù–´ –ò–ö–û–ù–ö–ò)
             */
            function renderSidebar() {
                // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –≤–∫–ª—é—á–∞—è "–í—Å–µ"
                const categories = ['–í—Å–µ', ...Object.keys(productsByCategory)].filter(c => c && c !== '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö');

                let html = `
                    <h3 class="text-xl font-extrabold text-gray-800 mb-4 border-b pb-2 border-red-200">
                        –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
                    </h3>
                    <nav class="space-y-1">
                `;

                categories.forEach(cat => {
                    const productCount = cat === '–í—Å–µ' ? allProducts.length : productsByCategory[cat]?.length || 0;

                    // –£–±—Ä–∞–Ω—ã –∏–∫–æ–Ω–∫–∏, –æ—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç
                    html += `
                        <button data-category="${cat}"
                                class="sidebar-link flex items-center justify-between w-full p-3 text-base font-semibold text-gray-700 hover:text-[#FF5E62] rounded-xl transition duration-150 ease-in-out whitespace-nowrap">
                            <span class="flex items-center">
                                ${cat}
                            </span>
                            <span class="text-xs bg-red-100/70 text-red-700 px-2 py-0.5 rounded-full">${productCount}</span>
                        </button>
                    `;
                });
                
                html += '</nav>';
                sidebar.innerHTML = html;

                // 1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤
                document.querySelectorAll('.sidebar-link').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const selectedCategory = e.currentTarget.getAttribute('data-category');
                        
                        // –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                        document.querySelectorAll('.sidebar-link').forEach(b => {
                            b.classList.remove('active-sidebar-link', 'bg-red-100', 'text-[#FF5E62]', 'font-bold');
                        });
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –Ω–∞ —Ç–µ–∫—É—â—É—é –∫–Ω–æ–ø–∫—É
                        e.currentTarget.classList.add('active-sidebar-link', 'bg-red-100', 'text-[#FF5E62]', 'font-bold');

                        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
                        filterCards(selectedCategory);
                        
                        // –ó–∞–∫—Ä—ã–≤–∞–µ–º sidebar –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
                        if (window.innerWidth < 768) {
                            closeSidebar(); 
                        }
                    });
                });

                // 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º '–í—Å–µ' –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                document.querySelector('.sidebar-link[data-category="–í—Å–µ"]')?.classList.add('active-sidebar-link', 'bg-red-100', 'text-[#FF5E62]', 'font-bold');
            }

            // --- MENU VIEW FUNCTIONS (–û—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
            function renderListView() {
                if (displayedProducts.length === 0) {
                    cardContainer.innerHTML = '<p class="col-span-full text-gray-800 text-center text-xl font-bold">–ë–ª—é–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                    return;
                }

                const html = displayedProducts.map((product, index) => `
					<div class="bg-white/80 backdrop-blur-md border border-white/90 rounded-2xl overflow-hidden shadow-xl flex flex-col animate-fade-in hover:scale-[1.02] transition-all duration-300 cursor-pointer"
							onclick="openModal(${index})">
						<div class="h-48 overflow-hidden relative">
							<img src="${product.display_image}" onerror="this.src='https://placehold.co/400x600/FFFFFF/FF5E62?text=–ù–µ—Ç+–§–æ—Ç–æ'" class="w-full h-full object-cover" loading="lazy">
							<span class="absolute top-2 right-2 bg-black/50 text-white text-xs px-3 py-1 rounded-full backdrop-blur-sm font-semibold">
								${product.display_category}
							</span>
						</div>
						<div class="p-4 text-gray-800 flex-grow flex flex-col">
							<h3 class="text-xl font-bold mb-2">${product.display_name}</h3>
							<p class="text-sm text-gray-700 mb-3 flex-grow line-clamp-3">${product.display_desc}</p>
							<div class="mt-auto pt-3 border-t border-gray-200">
								<p class="text-xs font-bold text-red-500"><i class="fas fa-exclamation-triangle mr-1"></i> –ê–ª–ª–µ—Ä–≥–µ–Ω—ã: ${product.display_allergen}</p>
							</div>
						</div>
					</div>
				`).join('');

                cardContainer.innerHTML = html;
            }


            /**
             * –§–∏–ª—å—Ç—Ä—É–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø–æ–∏—Å–∫–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É. (–û—Å—Ç–∞–ª–∞—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
             */
            function filterCards(category = null) {
                const searchValue = searchInput.value.toLowerCase();
                
                let currentCategory = category || document.querySelector('.sidebar-link.active-sidebar-link')?.getAttribute('data-category') || '–í—Å–µ';
                
                if (category === null) {
                    if (document.querySelector('.sidebar-link.active-sidebar-link')) {
                         currentCategory = document.querySelector('.sidebar-link.active-sidebar-link').getAttribute('data-category');
                    }
                }


                let filteredByCategory = currentCategory === '–í—Å–µ' ? allProducts :
                    allProducts.filter(p => p.display_category === currentCategory);

                displayedProducts = filteredByCategory.filter(p =>
                    p.display_name.toLowerCase().includes(searchValue) ||
                    p.display_allergen.toLowerCase().includes(searchValue)
                );

                renderListView();
            }

            // --- TRAINING VIEW FUNCTIONS (–û—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
            function renderTrainingButtons() {
                trainingLinksContainer.innerHTML = '';

                if (allTrainingMaterials.length === 0) {
                    trainingLinksContainer.innerHTML = '<p class="col-span-full text-gray-800 text-center text-lg mt-8">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–±—É—á–∞—é—â–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ Google Sheet –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å—Ç–æ–ª–±—Ü–æ–≤ ("–ù–∞–∑–≤–∞–Ω–∏–µ" –∏ "—Å—Å—ã–ª–∫–∞").</p>';
                    return;
                }

                const html = allTrainingMaterials.map(material => `
					<a href="${material.display_link}" target="_blank" rel="noopener noreferrer"
						class="training-button flex items-center justify-between p-4 rounded-xl shadow-lg transition-all duration-300 animate-fade-in">
						<span class="text-lg truncate">${material.display_name}</span>
						<i class="fas fa-arrow-right ml-4"></i>
					</a>
				`).join('');

                trainingLinksContainer.innerHTML = html;
            }

            // --- MODAL FUNCTIONS (–û—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
            window.openModal = function (index) {
                const product = displayedProducts[index];
                if (!product) return;

                modalBody.innerHTML = `
					<img src="${product.display_image}" onerror="this.src='https://placehold.co/400x600/FFFFFF/FF5E62?text=–ù–µ—Ç+–§–æ—Ç–æ'"
							class="w-full h-auto rounded-xl mb-4 shadow-lg object-cover max-h-64">
					
					<div class="text-center mb-4">
						<span class="text-sm font-bold text-amber-600 uppercase tracking-wider bg-amber-100 px-3 py-1 rounded-full">${product.display_category}</span>
						<h2 class="text-3xl font-extrabold text-gray-800 mt-2">${product.display_name}</h2>
					</div>

					<div class="space-y-4 text-gray-700">
						<div class="p-3 rounded-xl border border-gray-100 bg-gray-50/50">
							<div class="flex items-center mb-1 font-bold text-gray-800">
								<i class="fas fa-align-left text-amber-500 mr-2"></i>
								<span>–û–ø–∏—Å–∞–Ω–∏–µ/–°–æ—Å—Ç–∞–≤:</span>
							</div>
							<p class="text-base leading-relaxed">${product.display_desc}</p>
						</div>

						<div class="p-3 rounded-xl border border-red-200 bg-red-50">
							<div class="flex items-center mb-1 font-bold text-red-700">
								<i class="fas fa-exclamation-circle text-red-500 mr-2"></i>
								<span>–ê–ª–ª–µ—Ä–≥–µ–Ω—ã:</span>
							</div>
							<p class="text-base font-semibold text-red-600">${product.display_allergen}</p>
						</div>
					</div>
				`;
                productModal.style.display = 'block';
            }

            window.closeModal = function () {
                productModal.style.display = 'none';
            }

            window.onclick = function (event) {
                if (event.target == productModal) {
                    closeModal();
                }
            }

            /**
             * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü (–ú–µ–Ω—é, –û–±—É—á–∞—é—â–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª, –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ).
             */
            window.showPage = function (pageId) {
                const navButtons = document.querySelectorAll('.nav-link');
                const contents = [menuContent, trainingContent, testingContent];

                navButtons.forEach(btn => btn.classList.remove('active-nav-link'));

                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                contents.forEach(content => content.classList.add('hidden'));
                
                // –£–ø—Ä–∞–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å—é sidebar
                if (pageId === 'menu') {
                    // –í —Ä–µ–∂–∏–º–µ –º–µ–Ω—é –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∏–¥–µ–Ω, –Ω–æ –µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è toggleSidebar
                    sidebar.classList.remove('hidden'); 
                } else {
                    sidebar.classList.add('hidden'); // –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
                    // –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–∫—Ä—ã—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —á—Ç–æ–±—ã –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ –≤ –º–µ–Ω—é –Ω–µ –±—ã–ª–æ "–≤–Ω–µ–∑–∞–ø–Ω–æ–≥–æ" –æ—Ç–∫—Ä—ã—Ç–∏—è
                    if (window.innerWidth >= 768) {
                       sidebar.classList.remove('sidebar-closed-desktop');
                       isSidebarOpen = true;
                    }
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –¥–µ–ª–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫—É
                document.querySelector(`button[onclick="showPage('${pageId}')"]`).classList.add('active-nav-link');

                if (pageId === 'menu') {
                    menuContent.classList.remove('hidden');
                    searchInput.value = '';
                    filterCards(); 
                } else if (pageId === 'training') {
                    trainingContent.classList.remove('hidden');
                    loadTrainingData();
                } else if (pageId === 'testing') {
                    testingContent.classList.remove('hidden');
                    if (allProducts.length === 0) {
                        document.getElementById('quiz-loading-spinner').classList.remove('hidden');
                        quizStartScreen.classList.add('hidden');
                    } else {
                        document.getElementById('quiz-loading-spinner').classList.add('hidden');
                        quizStartScreen.classList.remove('hidden');
                    }
                    quizGameScreen.classList.add('hidden');
                    quizResultsScreen.classList.add('hidden');
                }
            }


            // --- QUIZ LOGIC (–û—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
            function prepareQuizCards() {
                const quizPool = allProducts.filter(p => p.display_allergen !== '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö' && p.display_allergen.trim() !== '');

                if (quizPool.length < TOTAL_QUESTIONS || allAllergens.size < 4) {
                    console.error("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–∞.");
                    return [];
                }

                const productsForQuiz = shuffleArray([...quizPool])
                    .slice(0, TOTAL_QUESTIONS);

                const quizSet = productsForQuiz.map(product => {
                    const correctAnswer = product.display_allergen;
                    
                    let distractors = [...allAllergens].filter(a => a !== correctAnswer);
                    distractors = shuffleArray(distractors).slice(0, 3);

                    const options = shuffleArray([correctAnswer, ...distractors]);

                    return {
                        question: product.display_name,
                        correctAnswer: correctAnswer,
                        options: options
                    };
                });

                return quizSet;
            }

            window.startQuiz = function (isRestart = false) {
                if (allProducts.length === 0) {
                    quizLoadStatus.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω—é.';
                    return;
                }

                quizCards = prepareQuizCards();
                if (quizCards.length < TOTAL_QUESTIONS) {
                     quizLoadStatus.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–ª—é–¥ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∞–ª–ª–µ—Ä–≥–µ–Ω–∞–º–∏ –¥–ª—è —Ç–µ—Å—Ç–∞.';
                     startQuizBtn.disabled = true;
                     return;
                }
                
                currentCardIndex = 0;
                correctAnswers = 0;
                incorrectAnswers = 0;

                quizStartScreen.classList.add('hidden');
                quizResultsScreen.classList.add('hidden');
                quizGameScreen.classList.remove('hidden');

                displayCard();
            }

            function displayCard() {
                if (currentCardIndex >= TOTAL_QUESTIONS) {
                    showResults();
                    return;
                }

                const card = quizCards[currentCardIndex];
                document.getElementById('current-question-index').textContent = currentCardIndex + 1;
                document.getElementById('correct-count').textContent = correctAnswers;
                document.getElementById('incorrect-count').textContent = incorrectAnswers;

                document.getElementById('quiz-question-dish').textContent = card.question;

                const optionsContainer = document.getElementById('quiz-options-container');
                optionsContainer.innerHTML = '';

                card.options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.className = 'quiz-option text-left';
                    button.setAttribute('data-answer', option);
                    button.onclick = () => handleAnswer(button, option, card.correctAnswer);
                    optionsContainer.appendChild(button);
                });
            }

            function handleAnswer(button, selectedAnswer, correctAnswer) {
                document.querySelectorAll('.quiz-option').forEach(btn => btn.classList.add('disabled'));

                const icon = document.createElement('i');
                icon.classList.add('quiz-result-icon');

                if (selectedAnswer === correctAnswer) {
                    button.classList.add('correct');
                    icon.classList.add('fas', 'fa-check');
                    correctAnswers++;
                } else {
                    button.classList.add('incorrect');
                    icon.classList.add('fas', 'fa-times');
                    incorrectAnswers++;

                    document.querySelectorAll('.quiz-option').forEach(btn => {
                        if (btn.getAttribute('data-answer') === correctAnswer) {
                            btn.classList.add('correct');
                        }
                    });
                }

                button.appendChild(icon);

                document.getElementById('correct-count').textContent = correctAnswers;
                document.getElementById('incorrect-count').textContent = incorrectAnswers;

                setTimeout(() => {
                    currentCardIndex++;
                    displayCard();
                }, 1500);
            }

            function getQuizTitle(score) {
                if (score === TOTAL_QUESTIONS) {
                    return 'üèÜ –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ú–æ–ª–æ–¥–µ—Ü! üèÜ';
                } else if (score >= TOTAL_QUESTIONS * 0.8) {
                    return '–û—Ç–ª–∏—á–Ω—ã–π –†–µ–∑—É–ª—å—Ç–∞—Ç! üåü';
                } else if (score >= TOTAL_QUESTIONS / 2) {
                    return '–ù–µ–ø–ª–æ—Ö–æ, –Ω–æ –º–æ–∂–Ω–æ –ª—É—á—à–µ! üòâ';
                } else {
                    return '–î–∞–≤–∞–π –ø–æ—Å—Ç–∞—Ä–∞–µ–º—Å—è –µ—â–µ —Ä–∞–∑! üí™';
                }
            }

            function showResults() {
                quizGameScreen.classList.add('hidden');
                quizResultsScreen.classList.remove('hidden');

                document.getElementById('final-score').textContent = `${correctAnswers} / ${TOTAL_QUESTIONS}`;
                document.getElementById('quiz-title').textContent = getQuizTitle(correctAnswers);
            }


            // --- FETCH DATA FOR MENU (–û—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
            async function loadMenuData() {
                menuSpinner.style.display = 'block';
                cardContainer.innerHTML = '';
                try {
                    const res = await fetchWithRetry(SHEET_URL_MENU);
                    const csvText = await res.text();
                    const parsedData = parseCSV(csvText, 'menu');

                    allProducts = parsedData;
                    displayedProducts = allProducts;
                    productsByCategory = {};
                    allAllergens.clear();

                    allProducts.forEach(p => {
                        const category = p.display_category;
                        if (!productsByCategory[category]) {
                            productsByCategory[category] = [];
                        }
                        productsByCategory[category].push(p);

                        if (p.display_allergen && p.display_allergen !== '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö') {
                             p.display_allergen.split(',').map(a => a.trim()).forEach(a => {
                                 if (a) allAllergens.add(a);
                             });
                        }
                    });

                    if (allProducts.length >= TOTAL_QUESTIONS && allAllergens.size >= 4) {
                        startQuizBtn.disabled = false;
                        quizLoadStatus.textContent = '–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã! –ù–∞—á–Ω–∏—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.';
                    } else {
                        startQuizBtn.disabled = true;
                        quizLoadStatus.textContent = `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–ª—é–¥ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∞–ª–ª–µ—Ä–≥–µ–Ω–∞–º–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ (–ù—É–∂–Ω–æ ${TOTAL_QUESTIONS} –±–ª—é–¥ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∞–ª–ª–µ—Ä–≥–µ–Ω–∞–º–∏).`;
                    }

                    renderSidebar();
                    filterCards('–í—Å–µ'); 

                } catch (error) {
                    console.error('Failed to load menu data:', error);
                    cardContainer.innerHTML = '<p class="col-span-full text-center text-red-600 font-bold text-xl p-8">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω—é. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ Google Sheet.</p>';
                    quizLoadStatus.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω—é.';
                } finally {
                    menuSpinner.style.display = 'none';
                }
            }
            
            // --- FETCH DATA FOR TRAINING (–û—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
            async function loadTrainingData() {
                if (allTrainingMaterials.length > 0) {
                    renderTrainingButtons();
                    return;
                }
            
                trainingSpinner.classList.remove('hidden');
                trainingLinksContainer.innerHTML = '';
            
                try {
                    const res = await fetchWithRetry(SHEET_URL_TRAINING);
                    const csvText = await res.text();
                    const parsedData = parseCSV(csvText, 'training');
            
                    allTrainingMaterials = parsedData;
                    renderTrainingButtons();
            
                } catch (error) {
                    console.error('Failed to load training data:', error);
                    trainingLinksContainer.innerHTML = '<p class="col-span-full text-center text-red-600 font-bold text-lg mt-8">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—É—á–∞—é—â–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ Google Sheet.</p>';
                } finally {
                    trainingSpinner.classList.add('hidden');
                }
            }


            // --- INITIALIZATION ---

            // 1. –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –ø–æ–∏—Å–∫–∞
            searchInput.addEventListener('input', () => {
                filterCards(); 
            });

            // 2. –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω—é –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
            loadMenuData();

            // 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ
            // (–£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ, –µ—Å–ª–∏ —ç—Ç–æ –¥–µ—Å–∫—Ç–æ–ø, sidebar –æ—Ç–∫—Ä—ã—Ç)
            if (window.innerWidth >= 768) {
                // –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å—ã –º–æ–±–∏–ª—å–Ω–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è
                sidebar.classList.remove('sidebar-mobile-closed');
                // –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –∫–ª–∞—Å—Å –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —Ç–∞–∫ –∫–∞–∫ isSidebarOpen = true
            }
            
            // 4. –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
            window.addEventListener('resize', () => {
                if (window.innerWidth >= 768) {
                    // –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø, —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ sidebar –Ω–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –∏ –Ω–µ –∑–∞–∫—Ä—ã—Ç –ø–æ –º–æ–±–∏–ª—å–Ω–æ–º—É –ø—Ä–∞–≤–∏–ª—É
                    sidebar.classList.remove('sidebar-mobile-closed');
                    sidebarOverlay.classList.add('hidden');
                    
                    // –ï—Å–ª–∏ isSidebarOpen –±—ã–ª–æ true –¥–æ —Ä–µ—Å–∞–π–∑–∞, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ –æ—Ç–∫—Ä—ã—Ç—ã–º
                    if (isSidebarOpen && sidebar.classList.contains('sidebar-closed-desktop')) {
                        sidebar.classList.remove('sidebar-closed-desktop');
                    } else if (!isSidebarOpen && !sidebar.classList.contains('sidebar-closed-desktop')) {
                        // –ï—Å–ª–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç–æ, –Ω–æ –Ω–µ –∏–º–µ–µ—Ç –∫–ª–∞—Å—Å–∞
                        sidebar.classList.add('sidebar-closed-desktop');
                    }

                } else {
                    // –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã–π, –µ—Å–ª–∏ –¥–µ—Å–∫—Ç–æ–ø –±—ã–ª –∑–∞–∫—Ä—ã—Ç, —Å–∫—Ä—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—ã–π.
                    if (sidebar.classList.contains('sidebar-closed-desktop')) {
                        sidebar.classList.add('sidebar-mobile-closed');
                    }
                }
            });
        });
    </script>
</body>

</html>

